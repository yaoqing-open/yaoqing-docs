## Data Transformation Guidelines

1.  A `WHERE` condition must be included to filter the table data, ensuring that the amount of real-time computed data remains within a defined scope.
    -   **Daily Jobs** - Limit processing to data from the last 2 days. Use conditions like `where millis >= LAST_2_DAY()` or `where timestamp >= LAST_2_DAY_STRING()`.
    -   **Hourly Jobs** - Limit processing to data from the last 3 hours. Use conditions like `where millis >= LAST_3_HOUR()` or `where timestamp >= LAST_3_HOUR_STRING()`.
    -   **Minute-level Jobs** - Limit processing to data from the last 2 minutes. Use conditions like `where millis >= LAST_2_MINUTE()` or `where timestamp >= LAST_2_MINUTE_STRING()`.

2.  Each table or subquery must be assigned an alias, and the state retention time should be configured via these aliases to prevent the real-time task state from growing indefinitely and causing system failures.
    -   **Daily Jobs** - The default state retention time is 3 days.
    -   **Hourly Jobs** - The default state retention time is 4 hours.
    -   **Minute-level Jobs** - The default state retention time is 3 minutes.
    -   **Note**: If there are dimension tables, the `STATE_TTL` annotation should be used to customize the state retention time for each table. Dimension tables should be set to `0s`, meaning they never expire, while other tables should be configured according to specific requirements.
    ```
    -- Example: right_table is a dimension table.
	SELECT /*+ STATE_TTL('A' = '3d', 'B' = '0s')*/ 
	col1,col2,...... FROM 
	left_table as A LEFT JOIN right_table as B ON ... 
	WHERE A.time >= LAST_2_DAY_STRING() ....;
    ```

3.  For requirements involving timezone conversions, do not perform daily aggregations directly on the original timestamps. Instead, create an hourly job first to handle the timezone conversion, and then aggregate the hourly results into daily ones.
4.  When performing a `LEFT JOIN`, it is recommended to place the fact stream (e.g., an orders table) on the left side and the dimension table (e.g., a products table) on the right side.
5.  Whenever possible, perform filtering and pre-aggregation on each table *before* the join operation to reduce the pressure on the join state.

