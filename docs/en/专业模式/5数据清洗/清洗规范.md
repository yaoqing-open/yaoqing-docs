## Data Transformation Guidelines

1.  A `WHERE` clause must be used to filter the source data to prevent the volume of real-time data from growing indefinitely, which could lead to job failures.
    -   **Daily Jobs** - Limit processing to data from the last 2 days. Use conditions like `where millis >= LAST_2_DAY()` or `where timestamp >= LAST_2_DAY_STRING()`.
    -   **Hourly Jobs** - Limit processing to data from the last 3 hours. Use conditions like `where millis >= LAST_3_HOUR()` or `where timestamp >= LAST_3_HOUR_STRING()`.
    -   **Minute-level Jobs** - Limit processing to data from the last 2 minutes. Use conditions like `where millis >= LAST_2_MINUTE()` or `where timestamp >= LAST_2_MINUTE_STRING()`.

2.  For multi-table joins, the state Time-To-Live (TTL) must be configured for each table to prevent the job's state from growing indefinitely, which could lead to failures.
    -   **Daily Jobs** - State TTL: 3 days.
    -   **Hourly Jobs** - State TTL: 4 hours.
    -   **Minute-level Jobs** - State TTL: 3 minutes.
    -   **Note**: If the `right_table` is a dimension table, its TTL should be set to `0s` for permanent retention (no expiration).
    ```
    -- Example:
    SELECT /*+ STATE_TTL('A' = '3d', 'B' = '0s')*/ * FROM left_table as A LEFT JOIN right_table as B ON ...;
    ```

3.  For requirements involving timezone conversions, do not perform daily aggregations directly on the original timestamps. Instead, create an hourly job first to handle the timezone conversion, and then aggregate the hourly results into daily ones.
4.  When performing a `LEFT JOIN`, it is recommended to place the fact stream (e.g., an orders table) on the left side and the dimension table (e.g., a products table) on the right side.
5.  Whenever possible, perform filtering and pre-aggregation on each table *before* the join operation to reduce the pressure on the join state.

