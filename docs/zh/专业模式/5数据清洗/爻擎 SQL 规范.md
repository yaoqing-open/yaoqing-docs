# çˆ»æ“Ž SQL

## ä½œä¸šåˆ†ç±»
å¿…é¡»æœ‰`WHERE`æ¡ä»¶å¯¹è¡¨çš„æ•°æ®åšè¿‡æ»¤ï¼Œä»¥ä¿éšœå®žæ—¶è®¡ç®—æ•°æ®é‡é™å®šåœ¨èŒƒå›´å†…ã€‚  
  - å¤©ä½œä¸šï¼šé™åˆ¶è®¡ç®—è¿‘2å¤©æ•°æ®ï¼Œæ”¯æŒæ¯å°æ—¶è¡¥å¿ä¸€æ¬¡åŽ†å²æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨æ¡ä»¶ `WHERE millis >= LAST_2_DAY()` æˆ– `WHERE timestamp >= LAST_2_DAY_STRING()` ã€‚
  - æ—¶ä½œä¸šï¼šé™åˆ¶è®¡ç®—è¿‘3å°æ—¶æ•°æ®ï¼Œæ”¯æŒæ¯5åˆ†é’Ÿè¡¥å¿ä¸€æ¬¡åŽ†å²æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨æ¡ä»¶ `WHERE millis >= LAST_3_HOUR()` æˆ– `WHERE timestamp >= LAST_3_HOUR_STRING()` ã€‚
  - åˆ†ä½œä¸šï¼šé™åˆ¶è®¡ç®—è¿‘2åˆ†é’Ÿæ•°æ®ï¼Œæ”¯æŒæ¯5åˆ†é’Ÿè¡¥å¿ä¸€æ¬¡åŽ†å²æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨æ¡ä»¶ `WHERE millis >= LAST_2_MINUTE()` æˆ– `WHERE timestamp >= LAST_2_MINUTE_STRING()` ã€‚

## çŠ¶æ€é™åˆ¶
æ¯ä¸ªè¡¨æˆ–å­æŸ¥è¯¢ï¼Œéƒ½å¿…é¡»è®¾ç½®åˆ«åï¼Œé€šè¿‡åˆ«åè®¾ç½®å„ä¸ªè¡¨çš„çŠ¶æ€å­˜ç•™æ—¶é—´ï¼Œä»¥ä¿éšœå®žæ—¶ä»»åŠ¡çŠ¶æ€ä¸ä¼šæ— é™å¢žé•¿è€Œå´©æºƒã€‚  
  - å¤©ä½œä¸š - æ‰€æœ‰çŠ¶æ€é»˜è®¤ä¿å­˜3å¤©ã€‚
  - å°æ—¶ä½œä¸š - æ‰€æœ‰çŠ¶æ€é»˜è®¤ä¿å­˜4å°æ—¶ã€‚
  - åˆ†é’Ÿä½œä¸š - æ‰€æœ‰çŠ¶æ€é»˜è®¤ä¿å­˜3åˆ†é’Ÿã€‚  

æ³¨ï¼šå¦‚æžœæœ‰ç»´è¡¨ï¼Œåˆ™åº”è¯¥ä½¿ç”¨`STATE_TTL`æ³¨è§£ï¼Œè‡ªå®šä¹‰æ¯ä¸ªè¡¨çŠ¶æ€çš„ä¿ç•™æ—¶é—´ï¼Œå…¶ä¸­ç»´è¡¨è®¾ç½®ä¸º0sï¼Œå³æ°¸ä¸è¿‡æœŸï¼Œå…¶ä»–è¡¨æŒ‰éœ€æ±‚è®¾ç½®ã€‚


## æ¸…æ´—ç¤ºä¾‹
 ```sql
 -- left_tableä¸ºä¸»è¡¨ï¼Œright_table ä¸ºç»´è¡¨ï¼Œtarget_tableä¸ºç»“æžœè¡¨
 INSERT INTO target_table
 SELECT /*+ STATE_TTL('A' = '3d', 'B' = '0s')*/ 
 col1,col2,...... FROM 
 left_table as A LEFT JOIN right_table as B ON ... 
 WHERE A.time >= LAST_2_DAY_STRING() ....;
 ```

## ä¼˜åŒ–å»ºè®®
- å¦‚æœ‰æ—¶åŒºè½¬æ¢éœ€æ±‚ï¼Œåˆ™è¯·ä¸è¦ç›´æŽ¥åŸºäºŽåŽŸå§‹æ—¶é—´æ±‡èšæˆå¤©ä»»åŠ¡ï¼Œåº”è¯¥å…ˆåˆ›å»ºå°æ—¶ä»»åŠ¡å¤„ç†å¥½æ—¶åŒºè½¬æ¢ï¼Œç„¶åŽå†æ±‡èšæˆå¤©ã€‚
- è¿›è¡Œ `LEFT JOIN` æ—¶ï¼Œå»ºè®®å°†äº‹å®žæµï¼ˆå¦‚è®¢å•è¡¨ï¼‰æ”¾åœ¨å·¦ä¾§ï¼Œç»´è¡¨ï¼ˆå¦‚å•†å“è¡¨ï¼‰æ”¾åœ¨å³ä¾§ã€‚  
- å°½é‡å„è¡¨å…ˆè‡ªè¡Œè¿›è¡Œè¿‡æ»¤èšåˆï¼Œç„¶åŽå†è¿›è¡Œå…³è”ï¼Œå‡å°‘ JOIN çŠ¶æ€åŽ‹åŠ›ã€‚    

## çˆ»æ“Ž SQL å‡½æ•°
> [ðŸ‘‰çˆ»æ“Ž SQL å‡½æ•°](çˆ»æ“Ž%20SQL%20å‡½æ•°)

